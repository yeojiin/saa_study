### WhatIsTheTime.com 
무상태 어플리케이션, DB가 필요 없음 -> 시간을 알려주는 어플리케이션이 있음
- 탄력적 IP로 사용자들에게 변하지 않는 공용 IP를 제공
- 다운 타임을 제거하기 위해 `수직 확장`이 필요 -> 부하 처리
	- 사용자가 많아져 수직 확장 -> 하지만 수직확장하는 동안 인스턴스를 중지하고 용량을 늘려 다운타임이 발생했음
- 더 많은 사용자그룹이 많아져 `수평 확장`을 해 인스턴스 수를 늘림
	- 늘린 인스턴스의 수만큼 탄력적 IP가 연결됨
	- 너무 많은 사용자들이 탄력적IP를 가져야 함으로 어려워짐
- Route53을 이용해 사용자들이 Route53에 쿼리 접속하면 인스턴스에 접근
	- api.whatisthetime.com을 TTL이 한시간인 A레코드로 IP 설정
	- 관리할 탄력적 IP도 없어짐
	- 하지만 A레코드를 인스턴스만큼 각각 연결할 경우 하나의 인스턴스가 종료되면 TTL이 1시간이라 해당 인스턴스에 붙은 사용자들은 남은 시간동안 나머지 인스턴스에 접근이 불가능해 서비스 이용 불가
- `로드밸런서`를 추가해서 상태 확인으로 장애가 난 인스턴스를 무시하고 서비스 안정성 확보
	- 공용 인스턴스를 없애고 사설 EC2 인스턴스들만 남김
	- 같은 가용 영역에 수동으로 실행
	- 보안 그룹을 가지고 접근해서 더욱 안정화
	- 로드밸런서가 IP 주소를 지속적으로 바꾸기 때문에(인스턴스가 재실행될 때마다 ip가 바뀌기 때문) A레코드를 사용할 수 없음
	- 로드밸런서이기 때문에 `별칭 레코드`를 사용할 수 있음 -> Route 53으로부터 ELB를 가리킴
	- 하지만 수동으로 인스턴스를 추가 삭제가 어려움
- 오토 스케일링 그룹을 이용함
	- 사용자의 부하에 따라 인스턴스 수가 조절됨
- 재해가 발생 해 가용 영역 1번이 다운됨
	- 다중 AZ를 사용 -> ELB는 3개의 AZ를 가지게 되고, 오토 스케일링 그룹 역시 3개의 AZ에 걸침
	- 가용성 확복
- AZ에 하나이상의 인스턴스는 항상 떠있기 때문에 용량을 `예약`하면 비용을 줄일 수 있음, 스팟 용량을 사용해도 되긴 함
### MyClothes.com
상태 유지 어플리케이션 -> 커머스 웹일 경우, 외부 연동 등이 필요할 수 도 있음
- 쇼핑몰 시스템으로 DB가 필요하고 장바구니는 계속해서 유지되어야 함
- Route53과 다중 AZ ELB가 있고, 오토 스케일링 그룹과 세 개의 AZ가 기본적으로 셋팅된 상태라고 가정
- 어떤 인스턴스에 요청을 보낼 때 장바구니가 있음, 다음 요청을 했는데 다른 인스턴스로 가서 장바구니가 사라짐
- Stickiness(Session Affinity - 세션 밀접성)을 도입함
	- `ELB stickiness`를 활성화 함
	- 하지만 결국 다른 인스턴스로 접근하면 장바구니는 사라짐
- `사용자 쿠키`를 이용해 EC2 인스턴스가 장바구니를 저장하는 대신 사용자 쪽에서 장바구니를 저장하도록 함
	- 쿠키의 양이 커지면 HTTP 요청이 점점 더 무거워 짐
- `서버 세션`을 도입
	- 쿠키로 데이터를 보내는 대신에 세션 ID만 전송
	- 백그라운드에서 `ElastiCache` 에 내용을 저장하고 불러오는 `세션 ID`를 생성
		- 공격자는 ElastiCache 내부를 수정할 수 없어서 안전함
	- 또는 `DynamoDB`를 이용할 수도 있음
- 사용자의 주소, 이름 등의 데이터를 RDS와 직접 통신해서 가져올 수 있음
	- 읽기와 쓰기 전용 RDBS를 나눌 수 있음 -> 더 오래된 정보를 저장하기 위해
	- 또는 캐시를 사용하는 쓰기 모드를 선택할 수도 있음
	- 사용자가 EC2 인스턴스와 통신하는 방식으로 작동하는데 캐시를 살펴보고 해당 정보가 있으면 리턴, 없으면 RDS에서 읽어서 ElastiCache에 넣음 - 캐시 히트
		- RDS 트래픽을 줄일 수 있음
	- 캐시 유지보수가 필요해 짐
- 재해 대비를 위해 다중 AZ ELB를 만들었고, 오토 스케일링 그룹도 다중 AZ로 설정되어 있음
	- RDS 역시 다중 AZ 사용할 수 있음
	- 또는 재해가 발생할 경우 인계받을 수 있는 `대기 복제본`을 만들 수 있음
	- Redis를 사용한다면 ElasriCache도 다중 AZ 기능을 쓸 수 있음
- 보안 관련해서 ELB 쪽 어디에서나 HTTP, HTTPS 트래픽을 열 수 있어야 함
	- EC2 인스턴스는 로드 밸런서로부터 오는 트래픽만 제한하고, ElastiCache는 EC2 보안 그룹으로부터 오는 트래픽만 제한하려 함
- `클라이언트 티어, 웹 티어, DB 티어` 3개의 티어가 있게됨 -> 보편적인 아키텍처
-  비용이 증가함
### MyWordPress.com
상태 유지 웹 어플리케이션, 완전히 확장된 서비스
- WordPress를 AWS에 배포하길 원함
	- 해당 웹사이트에 접근하고 싶고, 업로드한 그림이 바르게 나타나길 원함
	- 모든 인스턴스들이 해당 데이터에 접근이 가능해야 함
	- 사용자 데이터와 블로그 내용은 MySQL DB 에 저장되길 원하고 이를 글로벌하게 확장하고 싶음
- `RDS 계층 생성`이 필요함
	- `Aurora Mysql`을 사용해서 확장할 수 있음 -> 다중 AZ, 읽기 전용 복제본, 글로벌 DB까지 적용 가능
- 이미지 저장이 필요함
	- 하나의 EC2 인스턴스가 있고, 하나의 EBS 볼륨이 연결되어 있는 단일 AZ라고 가정
	- 사용자가 이미지를 로드 밸런서로 보내면 이지미는 EBS까지 도달하고 거기에 저장됨
	- 하지만 EC2가 두개가 되고 AZ가 두개라고 가정하면 각각의 EC2 인스턴스는 각각의 EBS 볼륨을 갖게 됨
	- 이미지를 저장 후 불러올 때 다른 EBS로 가서 이미지가 없는 문제가 발생
- `EFS`를 사용함
	- EFS는 NFS(network file system)으로 탄력적인 네트워크 인터페이스를 위해 `각각의 AZ에 ENI를 생성함`
	- ENI는 EFS 드라이브에 접근하는 모든 EC2에 사용 가능
	- 즉 M5 인스턴스로 이미지를 전송 -> ENI를 거쳐 -> EFS로 전달 -> EFS에 이미지가 저장됨
	- 이미지 호출 -> ENI -> EFS에서 읽어옴
	- 분산 어플리케이션이 됨
	- 비용은 EBS < EFS
### 어플리케이션을 빠르게 인스턴스 화
- EC2 인스턴스에 `Golden AMI`를 만들어서 빠르게 EC2 기동 가능
	- OS 종속성 등 모든 것을 사전에 설치한 AMI
	- OS 등이 미리 설치되어 빠르게 인스턴스를 올릴 수 있음 -> 재설치 등이 필요 없기 때문
- 사용자 데이터를 미리 설정해 인스턴스를 부트스트랩 할 수 있음
- `Elastic Beanstalk`는 Golden AMI를 구성하고 EC2 사용자 데이터를 추가하는 하이브리드 방식으로 이용 가능
- RDS 데이터베이스는 `스냅샷`으로 복구 가능
- 스냅샷으로 EBS 볼륨을 복구하면 데이터를 검색하려고 할 때 더 빠르게 할 수 있음
### BeanStalk
- 비슷한 서비스들을 런칭할 때 비슷한 작업들을 반복해야 함
- BeanStalk은 개발자 입장에서 어플리케이션을 AWS에 배포 - 하나의 인터페이스에서 EC2, ASG, ELB, RDS 등 `모든 컴포넌트를 재사용`
- 용량 프로비저닝, 로드 밸런서 설정, 스케일링, 어플리케이션 상태 모니터링, 인스턴스 설정 등 처리
- BeanStalk에서 하나의 인터페이스 번들로 제공되기 때문에 모든 컴포넌트 설정을 통제할 수도 있음
- 어플리케이션 자체의 `버전 관리`가 가능
- 구성 요소
	- 어플리케이션
	- 어플리케이션 버전
	- 2개의 티어가 존재함
		- 웹 서버 환경 티어
			- 로드밸런서가 있음
			- 트래픽을 오토 스케일링 그룹에 전송하고, 뒤에 다수의 EC2 인스턴스가 있는 전통적 아키텍처
		- 워커 환경 티어
			- EC2 인스턴스에 직접적으로 액세스하는 클라이언트가 없음
			- SQS Queue로 메시지가 전송되고, EC2 인스턴스는 워커가 됨
			- 워커 환경은 SQS 메세지의 개수에 따라 스케일링 됨
			- 웹 환경이 메시지를 워커 환경의 SQS Queue에 푸시하게 함으로 웹 환경과 워커 환경을 하나로 모을 수 있음
- dev, test, prod 같은 다양한 환경을 구성할 수 있음
- 프로세스는 어플리케이션을 생성 -> 버전을 업로드 -> 환경을 시작 -> 환경 라이프 사이클 관리
- 많은 언어를 지원하고 없다면 커스텀도 가능
- 배포 모드
	- 싱글 인스턴스: 개발용
		- 하나의 EC2 인스턴스를 가지고 이는 탄력적 IP를 가짐
		- RDS DB를 시작할 수 있고, 탄력적 IP를 가진 인스턴스를 기반으로 함
	- Elastic Beanstalk 모드: 상용
		- 로드 밸런서를 사용하는 고가용성 -> 다수의 EC2로 분산 처리 가능
		- ASG와 멀티 AZ도 이용 가능
		- 마스터와 스탠바이가 있는 RDS도 가질 수 있음
- BeanStalk을 생성하면 클라우드 포메이션에 스택이 생성됨
