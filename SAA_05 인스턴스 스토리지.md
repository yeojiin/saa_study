### EBS 개요
- EBS볼륨: elastic block store
- 인스턴스가 싱행 중인 동안 연결 가능한 네트워크 드라이브 -> 사용하면 인스턴스가 종료되더라도 데이터를 지속할 수 있음
- 물리적 드라이브가 아닌 `네트워크 드라이브`
- EC2 인스턴스에서 분리될 수  있음
- CCP 레벨: <u>하나의 EBS는 하나의 EC2 인스턴스에서만 마운트 가능</u>
	- 하지만 인스턴스는 여러 EBS에 연결할 수 있음
- 어소시에이트 레벨 : 일부 EBS 다중 연결
- EBS 볼륨은 특정 가용 영역에서만 생성 가능
	- us-east-1a 에서 생성되면 us-east-1b에서는 연결 불가능
	- `스냅샷을` 이용하면 옮길 수 있긴 함
	- 볼륨이기 때문에 용량을 미리 정해야 함
		- GB, IOPS(초당 전송 수)를 미리 지정해야 함
		- 무료등급으로 매달 30G EBS 스토리지가 범용 SSD 또는 마그네틱 유형으로 제공됨
	- 인스턴스 종료 시 EBS볼륨을 삭제하도록 delete on termination으로 설정할 수 있고, 루트 볼륨은 기본 설정 되어 있으나 나머지는 해줘야 함
### EBS 스냅샷 
- EBS 볼륨의 특정 시점에 대한 백업
- EC2 인스턴스에서 EBS 볼륨을 분리할 필요는 없지만 권장 사항임
- <u>스냅샷은 다른 가용 영역이나 다른 리전에 복사할 수도 있음</u>
	- 스냅샷을 뜨고 해당 스냅샷을 다른 곳에 띄우면 볼륨이 유지된 채로 띄울 수 있음(AZ -> AZ전송 가능)
- 스냅샷 아카이브
	- 75프로 저렴, 24~72시간 이내 아카이브를 회복할 수 있음, 즉시 회복은 안됨
- 스냅샷 휴지통
	- 스냅샷을 영구 삭제하지 않고 휴지통에 넣음
	- 복원 가능
	- 1일~1년 사이로 기간 설정 가능
- 빠른 회복 (FSR - fast snapshot restore)
	- 스냅샷을 완전 초기화 해 첫 사용에서의 지연 시간을 없앰
	- 스냅샷이 크고 빠르게 복원이 필요할 때 유용하지만 비쌈
### AMI
- 아마존 머신 이미지 -> EC2 인스턴스를 통해 만든 이미지
- AMI로 EC2인스턴스를 커스텀할 수 있음
- 원하는 소프트웨어나 운영체제 등을 설치해서 사용할 수 있음
- 부팅 및 설정 시간을 줄일  수 있음 -> 복사해서 띄우면 됨
- EC2만들 때 리눅스~ 선택하는 것이런게 AMI
- 자체 AMI를 만들 수도 있음 -> 자체 소프트 웨어 등을 설치해서 마켓 등에 판매 가능
- 순서
	- EC2 인스턴스를 커스텀 해서 만들고
	- stop 한다음 -> 무결성 확보
	- 이 인스턴스를 바탕으로 AMI 구축 -> EBS 스냅샷이 생성됨
	- 다른 AZ에서 AMI를 사용할 수 있음
### EC2 인스턴스 스토어
- if need high-performance hardware disk -> ec2 instance store 사용
- 더 높은 성능이 필요하다면 EC2 인스턴스에 연결된 하드웨어 디스크 성능이 향상되어야 함
- EC2는 가상 머신이지만 실제로는 하드웨어에 연결되어 있음
- EC2에 연결된 물리적 하드웨어
- **EC2를 중지하면 해당 스토리지는 손실됨** -> `임시 스토리지`
- 임시스토리지: 버퍼, 캐시, 스크래치 데이터 또는 임시 콘텐츠를 사용할 경우
- 장기적인 스토리지는 EBS가 적합
- 기본 서버에 장애가 발생하면 물리적 하드웨어도 영향이 있어서 데이터 손실이 있을 수 있음 -> 백업 필요
### EBS 볼륨 타입
- gp2/gp3: 범용 SSD 볼륨
	- gp2: 짧은 지연 시간, 비용이 효율적
	- 시스템 부팅, 가상 데스크톱 등 다양하게 사용됨
	- 1G~16TB
	- gp3: 3000 IOPS, 125mb 처리량
		- 16000 IOPS 까지 늘릴 수 있으며 1000mb까지 늘릴 수 있음
		- **IOPS와 처리량을 독자적으로 설정 가능
	- gp2: 더 작은 볼륨
		- 3000 IOPS 
		- 16000 IOPS 까지 늘릴 수 있음
		- **IOPS와 처리량을 동일하게 움직임
- io1/io2:  최고의 성능 SSD, 미션 크리티컬이자 지연시간이 낮고 대용량의 워크로드에 사용됨
	- 6400 IOPS까지 가능
	- EC2가 아니면 3200까지도 가능
- st1: 저비용의 HDD 볼륨, 잦은 접근과 처리량이 많은 워크로드에 사용
- sc1: 비용이 가장 적게 드는 HDD 볼륨, 접근이 낮은 워크로드에 사용
- 분류
	- 크기
	- 처리량
	- IOPS : 초당 I/O 작업 수
- EC2 에서는 gp2/gp3와 io1/io2만 사용 가능
#### 프로비져닝 IOPS
- IOPS성능을 유지해야 하는 주요 비즈니스 어플리케이션
- 16000 IOPS를 유지하는 어플리케이션에 적합
- DB에 사용하기 적합
- 성능을 높이고 싶으면 io1/io2 중에 최신으로 가는 것이 좋음
- io2는 io1과 동일한 비용으로 내구성과 기기당 IOPS 수가 더 높음
#### st1과 sc1 (HDD)
- 부트 볼륨
- Throughput Optimized HDD(stl):
	- 빅데이터나 데이터 웨어하우징 로그 처리에 적합
	- 500 IOPS까지 가능
- Cold HDD(scl): 아카이브 데이터용, 접근 빈도가 낮은 데이터에 용이, 최저비용으로 데이터 저장 시
	- 250 IOPS
### EBS 볼륨 다중 연결
- io1/io2에서만 사용 가능
- 어플리케이션이 동시 읽기/쓰기 작업을 관리해야할 때 유용
- 해당 AZ에서만 사용 가능
- `16개의` 인스턴스만 연결 가능
- 반드시 클러스터 인식 파일 시스템을 사용해야 함
### EBS 암호화
- 저장 데이터가 암호화 되고, 전송 데이터도 암호화, 스냅샷도 암호화됨
- 지연 시간에는 영향이 거의 없고, KMS에서 암호화 키를 생성해 AES-256을 이용해 암호화
- 스냅샷을 복사해 암호화를 푼것을 다시 암호화 활성화해서 실행하는 방식
- 순서
	- EBS 스냅샷 생성
	- 복사기능을 통해 EBS 스냅샷 암호화
	- 스냅샷을 이용해 새 EBS 볼륨을 생성 -> 암호화
	- 암호화된 볼륨을 인스턴스 원본에 연결
### 아마존 EFS(elastic file system)
- EFS는 관리형 NFS(network file system), 네트워크 파일 시스템
- 많은 EC2가 마운트 될 수 있음 -> 서로 다른 AZ에 존재할 수 있게 해 줌
- 가용성이 높고 확장성이 뛰어나고 비싸다. GP2 EBS 볼륨의 약 3배
- 콘텐츠 관리, 웹 서빙, 데이터 공유, WordPress 등에 사용
- 내부적으로 NFS 프로토콜을 사용하며 EFS에 대한 액세스를 제어하려면 **보안 그룹을** 연결해야함
- `윈도우는 불가`, Linux 기반 AMI에서만 호환
- KMS를 사용해 미사용 암호화를 할 수 있음
- POSIX를 이용하고 표준 파일 API가 존재
- 용량을 미리 계획할 필요 없이 자동으로 확장되고 사용량에 따라 비용 부과
- EFS Scale
	- 동시 NFS 클라이언트 수천 개와 10G 이상의 처리량을 확보할 수 있음
	- PB 규모의 네트워크 파일 시스템으로 자동 확장 가능
- 성능 모드
	- 범용(default): 지연 시간에 민감한 어플에 사용, web server 또는 CMS
	- MAX i/o: 처리량이 높지만 지연시간이 높음, 빅데이터 어플이나 미디어 처리
- 처리량 모드
	- 버스팅: 1TB
	- 프로비저닝: 스토리지 크기에 관계 없이 쓸 때 -> 늘어나는대로, 스토리지와 처치량이 분리
	- 엘라스틱: 워크로드에 따라 자동으로 조정 -> 워크로드를 예측하기 어려울 때
- 스토리지 클래스
	- 스토리지 계층: 며칠 후 파일을 다른 계층으로 옮길 수 있음
		- 표준 계층: 자주 엑세스 하는 파일을 위한 계층
		- EFS-IA: 비용이 들지만 자주 엑세스 하지 않는 파일 계층 
			- 수명주기 정책 필요
- standard: 다중 AZ로 EFS 설정 가능 -> 상용에 적합, 가용영역 하나가 다운되더라도 영향을 주지 않기 때문
- one zone efs: 하나의 AZ에 있고, 백업 활성화 개발용으로 좋음, 비용 절감, 액세스 빈도가 낮은 스토리지 계층과 호환됨
### EBS vs EFS
- EBS: 하나의 인스턴스
	- io1/io2는 다중 연결 가능
	- AZ 하나에 의존
	- AZ간 EBS 볼륨을 마이그레이션하려면 스냅샷을 만들고, 다른 AZ로 복원할 수 있음
	- EBS 볼륨 백업은 IO를 사용하기 때문에 애플리케이션이 많은 트래픽을 처리할 경우 실행하면 안됨
- EFS: 하나의 EFS에서 여러 AZ
	- 리눅스 전용, 윈도우 사용 불가
	- 가격대가 더 높지만 EFS-IA 기능으로 절감 가능
	- EC2 손실되면 스토리지 손실이 큼

